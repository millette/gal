---
// astro
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'
// self
import Layout from "!layouts/layout.astro"
import { title } from "!root/consts.js"

// mettre les images dans src/assets/images/gallery/
// pnpm build && pnpm preview && google-chrome dist/index.html
// attention, les html utilisent un chemin absolu vers le r√©pertoire ./dist/ actuel.
// Load images from gallery
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/gallery/*.{jpeg,jpg,png,gif}')
const imageKeys = Object.keys(images)
const lastImageIndex = imageKeys.length
const heightSlider = 1080
const heightImage = heightSlider - 50
---

<Layout title={title}>
  <div class={`carousel w-full`}>
    {imageKeys.map((x, i) => (
      <div id={`slide${i + 1}`} class={`w-full max-h-[100vh] carousel-item relative`}>
        <Image
          height={heightImage}
          src={images[x]()}
          alt={`Image #${i + 1}`}
          class="object-scale-down w-full clickable" />
      </div>
    ))}
  </div>

  <script type="module" define:vars={{ imageKeys }}>
    const slideInterval = 5000;
    let currentSlide = 0;
    let isCarouselRunning = true; // Track whether the carousel is running
    let intervalId;

    // Function to change slides
    function changeSlide() {
      currentSlide = (currentSlide + 1) % imageKeys.length;
      const nextSlide = document.querySelector(`#slide${currentSlide + 1}`);
      if (nextSlide) {
        nextSlide.scrollIntoView({ behavior: 'smooth' });
      }
    }

    // Function to start the carousel
    function startCarousel() {
      intervalId = setInterval(changeSlide, slideInterval);
    }

    // Function to stop the carousel
    function stopCarousel() {
      clearInterval(intervalId);
    }

    // Function to toggle the carousel state
    function toggleCarousel() {
      if (isCarouselRunning) {
        stopCarousel();
      } else {
        startCarousel();
      }
      isCarouselRunning = !isCarouselRunning; // Toggle the running state
    }

    // Toggle the carousel on image click
    document.querySelectorAll('.clickable').forEach((image) => {
      image.addEventListener('click', toggleCarousel); // Directly call toggleCarousel
    });

    // Handle spacebar press to toggle carousel
    document.addEventListener('keydown', (event) => {
      if (event.code === 'Space') {
        event.preventDefault(); // Prevent the default spacebar behavior (scrolling)
        toggleCarousel(); // Call toggleCarousel on spacebar press
      }
    });

    // Start the carousel initially
    startCarousel();
  </script>
</Layout>